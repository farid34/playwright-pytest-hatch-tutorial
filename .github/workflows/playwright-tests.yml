# Nom du workflow affichÃ© dans l'interface
# visible dans l'onglet "Actions" du repo
name: Playwright E2E Tests

on: # DÃ©finit quand le workflow se dÃ©clenche
  push: # Se dÃ©clenche quand on fait "git push" sur la branche main ou master
    branches: [ main, master ]
  pull_request: # Se dÃ©clenche quand quelqu'un crÃ©e une "Pull request" vers main ou master (code testÃ© avant merge)
    branches: [ main, master ]
  workflow_dispatch: # Permet de lancer le workflow 'manuellement' depuis l'interface Github (Actions -> Run workflow -> clic)

jobs: # DÃ©finit les tÃ¢ches Ã  exÃ©cuter (1 ou n jobs, ex: test, build, deploy)
  test: # Nom du job
    timeout-minutes: 10 # Le job s'arrÃªte automatiquement aprÃ¨s 10 mn
    runs-on: ubuntu-latest # DÃ©finit la machine virtuelle utilisÃ©e

    steps: # Liste des Ã©tapes Ã  exÃ©cuter dans l'ordre
    - name: Checkout code
      uses: actions/checkout@v4 # TÃ©lÃ©charge le code depuis Github

    - name: Setup Python
      uses: actions/setup-python@v5 # Installe python 3.12
      with:
        python-version: '3.12'
    
    - name: ğŸ“¦ Install Hatch
      run: pip install hatch # Install hatch
    
    - name: ğŸ”§ Install dependencies
      run: hatch env create # CrÃ©er env virtuel hatch et install toutes les dÃ©pendances du pyproject.toml
    
    - name: ğŸŒ Install Playwright browsers
      run: hatch run install-browsers # Installe les navigateurs Palywright
    
    - name: ğŸ§ª Run tests
      run: hatch run test # Lancement des tests playwright
    
    - name: Generate Allure Report
      if: always()
      run: |
        sudo apt-get update
        sudo apt-get install -y allure
        hatch run allure-generate
  
    - name: ğŸ“¤ Upload test results
      # ExÃ©cute cette Ã©tape mÃªme si les tests Ã©chouent
      if: always()
      uses: actions/upload-artifact@v4 # Utilise l'action pour uploader des fichiers
      with:
        name: test-results # Nom de l'artifact (fichier zip qui contiendra vos rÃ©sultats)
        path: test-results/ # Dossier Ã  uploader (screenshot, vidÃ©os, traces)
        retention-days: 7 # Garde les fichiers pendant 7 jours et les suppriment automatiquement